var LaravelTable=function(){this.targetId="",this.sourceUrl="",this.token="",this.actionColumnEnabled=!1,this.tableDivWrapper="<div>",this.tableOpTag="<table>",this.tableHeaderOpTag="<thead>",this.tableHeaderTrOpTag="<tr>",this.tableHeaderTdOpTag="<th>",this.tableBodyOpTag="<tbody>",this.tableBodyTrOpTag="<tr>",this.tableBodyTdOpTag="<td>",this.actionColumnEditUrl=window.location.href+"/{id}/edit",this.actionColumnDeleteUrl=window.location.href+"/{id}/delete",this.laravelData={},this.init=function(){this.ready()},this.ready=function(){var a=this;let e=function(){for(var t=document.getElementsByClassName("page-link"),l=function(t){t.preventDefault(),a.sourceUrl=this.getAttribute("href"),a.generateTable(e)},i=0;i<t.length;i++)t[i].addEventListener("click",l,!1)};this.generateTable(e)},this.generateTable=function(a){fetch(this.sourceUrl,{headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json, text-plain, */*","X-CSRF-TOKEN":this.token,"Access-Control-Allow-Origin":"*"},method:"get",mode:"no-cors"}).then(a=>a.json()).then(e=>{this.laravelData=e,this.checkLaravelData()?(this.constructTable(),"function"==typeof a&&a()):this.messageUser("Invalid data from source!","error")}).catch(a=>{console.log(a)})},this.checkLaravelData=function(){let a=["current_page","data","first_page_url","from","last_page","last_page_url","next_page_url","path","per_page","prev_page","prev_page_url","to","total"],e=!0,t=this.laravelData;for(let l in t)if(!a.includes(l)){e=!1;break}return e},this.constructTable=function(){if(this.laravelData.data.length<1)return;let a=this.tableDivWrapper+this.tableOpTag;a+=this.generateTableHeader(),a+=this.generateTableBody(),a+="</table>",a+=this.generatePagination(),a+="</div>",document.getElementById(this.targetId).innerHTML=a},this.generateTableHeader=function(a){let e=this,t=this.tableHeaderOpTag+this.tableHeaderTrOpTag;for(var l=1,i=(a=this.laravelData.data).length;l<i;l++){for(let i in a[l])t+=e.tableHeaderTdOpTag+i.replace(/./,a=>a.toUpperCase()).replace(/_/," ")+"</th>";break}return this.actionColumnEnabled&&(t+=this.tableHeaderTdOpTag+"Action</th>"),t+="</tr></thead>"},this.generateTableBody=function(a){let e=this,t=this.tableBodyOpTag;for(var l=0,i=(a=this.laravelData.data).length;l<i;l++){t+=this.tableBodyTrOpTag;for(let i in a[l])t+=e.tableBodyTdOpTag+a[l][i]+"</td>";this.actionColumnEnabled&&(t+=this.tableBodyTdOpTag+'<a href="'+this.actionColumnEditUrl.replace("{id}",a[l].id)+'" class="btn btn-success">Edit</a>&nbsp;<a href="'+this.actionColumnDeleteUrl.replace("{id}",a[l].id)+'" class="btn btn-danger">Delete</a></td>'),t+="</tr>"}return t+="</tbody>"},this.generatePagination=function(){let a=this.laravelData.current_page,e=this.laravelData.first_page_url,t=this.laravelData.last_page,l=this.laravelData.last_page_url,i=this.laravelData.next_page_url,r=this.laravelData.path,s=this.laravelData.prev_page_url,n='<ul role="navigation" class="pagination" id="laravelTablePagination">';n+='<li  class="page-item '+(1==a?"disabled":"")+'">'+(1==a?'<span class="page-link">First</span>':'<a href="'+e+'" rel="next" class="page-link">First</a>')+"</li>",n+='<li class="page-item '+(1==a?"disabled":"")+'">'+(1==a?'<span class="page-link">Previous</span>':'<a href="'+s+'" rel="next" class="page-link">Previous</a>')+"</li>";for(var o=1,h=t;o<=h;o++)n+='<li class="page-item '+(a==o?"active":"")+'">'+(a==o?'<span class="page-link">'+o+"</span>":'<a href="'+r+"?page="+o+'" class="page-link">'+o+"</a>")+"</li>";return n+='<li class="page-item '+(a==t?"disabled":"")+'">'+(a==t?'<span class="page-link">Next</span>':'<a href="'+i+'" rel="next" class="page-link">Next</a>')+"</li>",n+='<li class="page-item '+(a==t?"disabled":"")+'">'+(a==t?'<span class="page-link">Last</span>':'<a href="'+l+'" rel="next" class="page-link" onclick="event.preventDefault()">Last</a>')+"</li>",n+="</ul>"},this.messageUser=function(a,e){if(void 0!==a)switch(void 0===e&&(e="info"),e){case"error":try{throw console.error("Error: "+a),""}catch(e){throw"Error: "+a}break;case"info":default:console.log(a)}}};
