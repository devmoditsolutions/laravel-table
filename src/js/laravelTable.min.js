var LaravelTable=function(){this.targetId="",this.sourceUrl="",this.token="",this.apiToken="",this.actionColumnEnabled=!1,this.reloadTime=0,this.tableDivWrapper="<div>",this.tableOpTag="<table>",this.tableHeaderOpTag="<thead>",this.tableHeaderTrOpTag="<tr>",this.tableHeaderTdOpTag="<th>",this.tableBodyOpTag="<tbody>",this.tableBodyTrOpTag="<tr>",this.tableBodyTdOpTag="<td>",this.actionColumnEditUrl=window.location.href+"/{id}/edit",this.actionColumnDeleteUrl=window.location.href+"/{id}/delete",this.laravelData={},this.activeSourceUrl="",this.init=function(){this.ready()},this.ready=function(){this.generateTable(this.paginationClickCB())},this.paginationClickCB=function(){for(var e=this,a=document.getElementsByClassName("page-link"),t=function(a){a.preventDefault(),e.sourceUrl=this.getAttribute("href"),e.generateTable(paginationClickCB)},i=0;i<a.length;i++)a[i].addEventListener("click",t,!1)},this.generateTable=function(e){var a=this;this.api&&(fetchConfig={headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json","X-CSRF-TOKEN":this.token,"Access-Control-Allow-Origin":"*"},method:"get",mode:"no-cors"}),this.apiToken&&(fetchConfig={credentials:"include",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json",Authorization:"Bearer "+this.apiToken},method:"get"}),fetch(this.sourceUrl,fetchConfig).then(e=>e.json()).then(t=>{if(this.laravelData=t,this.checkLaravelData())this.constructTable(),"function"==typeof e&&e(),parseInt(this.reloadTime)>0&&setTimeout(function(){a.generateTable(a.paginationClickCB())},parseInt(this.reloadTime)+"000");else{let e="Invalid data from source!";void 0!==t.message&&(e=t.message),this.messageUser(t.message,"error")}}).catch(e=>{console.log(e)})},this.checkLaravelData=function(){let e=["current_page","data","first_page_url","from","last_page","last_page_url","next_page_url","path","per_page","prev_page","prev_page_url","to","total"],a=!0,t=this.laravelData;for(let i in t)if(!e.includes(i)){a=!1;break}return a},this.constructTable=function(){if(this.laravelData.data.length<1)return;let e=this.tableDivWrapper+this.tableOpTag;e+=this.generateTableHeader(),e+=this.generateTableBody(),e+="</table>",e+=this.generatePagination(),e+="</div>",document.getElementById(this.targetId).innerHTML=e},this.generateTableHeader=function(e){let a=this,t=this.tableHeaderOpTag+this.tableHeaderTrOpTag;for(var i=0,l=(e=this.laravelData.data).length;i<l;i++){for(let l in e[i])t+=a.tableHeaderTdOpTag+l.replace(/./,e=>e.toUpperCase()).replace(/_/," ")+"</th>";break}return this.actionColumnEnabled&&(t+=this.tableHeaderTdOpTag+"Action</th>"),t+="</tr></thead>"},this.generateTableBody=function(e){let a=this,t=this.tableBodyOpTag;for(var i=0,l=(e=this.laravelData.data).length;i<l;i++){t+=this.tableBodyTrOpTag;for(let l in e[i])t+=a.tableBodyTdOpTag+e[i][l]+"</td>";this.actionColumnEnabled&&(t+=this.tableBodyTdOpTag+'<a href="'+this.actionColumnEditUrl.replace("{id}",e[i].id)+'" class="btn btn-success">Edit</a>&nbsp;<a href="'+this.actionColumnDeleteUrl.replace("{id}",e[i].id)+'" class="btn btn-danger">Delete</a></td>'),t+="</tr>"}return t+="</tbody>"},this.generatePagination=function(){let e=this.laravelData.current_page,a=this.laravelData.first_page_url,t=this.laravelData.last_page,i=this.laravelData.last_page_url,l=this.laravelData.next_page_url,s=this.laravelData.path,r=this.laravelData.prev_page_url,n='<ul role="navigation" class="pagination" id="laravelTablePagination">';n+='<li  class="page-item '+(1==e?"disabled":"")+'">'+(1==e?'<span class="page-link">First</span>':'<a href="'+a+'" rel="next" class="page-link">First</a>')+"</li>",n+='<li class="page-item '+(1==e?"disabled":"")+'">'+(1==e?'<span class="page-link">Previous</span>':'<a href="'+r+'" rel="next" class="page-link">Previous</a>')+"</li>";for(var o=1,h=t;o<=h;o++)n+='<li class="page-item '+(e==o?"active":"")+'">'+(e==o?'<span class="page-link">'+o+"</span>":'<a href="'+s+"?page="+o+'" class="page-link">'+o+"</a>")+"</li>";return n+='<li class="page-item '+(e==t?"disabled":"")+'">'+(e==t?'<span class="page-link">Next</span>':'<a href="'+l+'" rel="next" class="page-link">Next</a>')+"</li>",n+='<li class="page-item '+(e==t?"disabled":"")+'">'+(e==t?'<span class="page-link">Last</span>':'<a href="'+i+'" rel="next" class="page-link" onclick="event.preventDefault()">Last</a>')+"</li>",n+="</ul>"},this.messageUser=function(e,a){if(void 0!==e)switch(void 0===a&&(a="info"),a){case"error":try{throw alert("Error: "+e),console.error("Error: "+e),""}catch(a){throw"Error: "+e}break;case"info":default:alert(e),console.log(e)}}};
